<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jackdaw.client.partitioning documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jackdaw</span> <span class="project-version">0.4.2-gh-pages-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jackdaw</span></div></div></li><li class="depth-2 branch"><a href="jackdaw.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2"><a href="jackdaw.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.client.log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-3 current"><a href="jackdaw.client.partitioning.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>partitioning</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.data.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2"><a href="jackdaw.serdes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serdes</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.avro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>avro</span></div></a></li><li class="depth-4"><a href="jackdaw.serdes.avro.schema-registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-registry</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.edn.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-4"><a href="jackdaw.serdes.edn.nippy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nippy</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>fn</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn-impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn-impl</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.json.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>json</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.uuid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uuid</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.specs.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="jackdaw.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configurable.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configurable</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configured.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configured</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.extras.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extras</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.interop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interop</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.lambdas.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lambdas</span></div></a></li><li class="depth-4"><a href="jackdaw.streams.lambdas.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.protocols.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>protocols</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-1"><a href="user.html"><div class="inner"><span class="tree" style="top: -765px;"><span class="top" style="height: 774px;"></span><span class="bottom"></span></span><span>user</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jackdaw.client.partitioning.html#var-default-partition"><div class="inner"><span>default-partition</span></div></a></li><li class="depth-1"><a href="jackdaw.client.partitioning.html#var-default-partitioner*"><div class="inner"><span>default-partitioner*</span></div></a></li><li class="depth-1"><a href="jackdaw.client.partitioning.html#var-produce.21"><div class="inner"><span>produce!</span></div></a></li><li class="depth-1"><a href="jackdaw.client.partitioning.html#var-record-key-.3Ekey-fn"><div class="inner"><span>record-key-&gt;key-fn</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jackdaw.client.partitioning</h1><div class="doc"><pre class="plaintext">Extras for `jackdaw.client` which help you define record partitioning
schemes as part of a topic's configuration.

The partitioning API provided by Kafka, like the serdes API, leaves
a lot to be desired when trying to interop from Clojure. You have to
define a `org.apache.kafka.clients.producer.Partitioner` class
implementation with an 0-arity constructor, and you include the name
of that Partitioner class in your producer options. This seems to
have been done so that the Partitioner can have access to Kafka
internal state about the cluster, from which to read partition count
and related data. But this pretty soundly defeats Clojure's idioms
of avoiding class generation wherever possible and using instance
parameterization.

The `Producer` (and `Consumer`) APIs however do expose
`.partitionsFor` - a way to interrogate a topic to understand how
many partitions it contains.

This namespace defines a mechanism by which clients can define
"defaulting" behavior both for record keys, and for record
partitioning.

Lets say I want to specify that my topic is always partitioned by
some field of the records on the topic. It would be convenient to
let a (thin) framework handle that.

Likewise it would be convenient to easily define as normal Clojure
functions the computation by which I wish to assign records to
partitions, rather than having to code up a custom class.

This namespace provides both capabilities via an extended
`#'-&gt;ProducerRecord`, and provides a `#'produce!` identical to that
in `jackdaw.client` but backed by the partitioning machinery.</pre></div><div class="public anchor" id="var-default-partition"><h3>default-partition</h3><div class="usage"><code>(default-partition {:keys [topic-name key-serde]} key value partitions)</code></div><div class="doc"><pre class="plaintext">The kafka default partitioner. As a `::partition-fn`
</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.2-gh-pages-SNAPSHOT/src/jackdaw/client/partitioning.clj#L62">view source</a></div></div><div class="public anchor" id="var-default-partitioner*"><h3>default-partitioner*</h3><div class="usage"><code>(default-partitioner* key-bytes num-partitions)</code></div><div class="doc"><pre class="plaintext">Mimics the kafka default partitioner.
</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.2-gh-pages-SNAPSHOT/src/jackdaw/client/partitioning.clj#L56">view source</a></div></div><div class="public anchor" id="var-produce.21"><h3>produce!</h3><div class="usage"><code>(produce! producer topic value)</code><code>(produce! producer topic key value)</code><code>(produce! producer topic partition key value)</code><code>(produce! producer topic partition timestamp key value)</code><code>(produce! producer topic partition timestamp key value headers)</code></div><div class="doc"><pre class="plaintext">Like `#'jackdaw.client/produce!` but used the partitioning machinery
if possible rather than just building a `ProducerRecord`.

Returns a future which will produce datafied record metadata when
forced.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.2-gh-pages-SNAPSHOT/src/jackdaw/client/partitioning.clj#L99">view source</a></div></div><div class="public anchor" id="var-record-key-.3Ekey-fn"><h3>record-key-&gt;key-fn</h3><div class="usage"><code>(record-key-&gt;key-fn {:keys [record-key], :as t})</code></div><div class="doc"><pre class="plaintext">Given a topic config having `:record-key`, parse it,
annotating the topic with a `:Lkey-fn` which will simply fetch the
specified record-key out of any record.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.2-gh-pages-SNAPSHOT/src/jackdaw/client/partitioning.clj#L43">view source</a></div></div></div></body></html>